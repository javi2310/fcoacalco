"Tipo de vivienda: ", shp$SETT_TYPE,"<br>"))  %>%
addDrawToolbar(targetGroup='datos', position = "bottomleft",
editOptions = editToolbarOptions(selectedPathOptions = selectedPathOptions())) %>%
addCircleMarkers(color="#1788d3", radius = 10, label ="San Pablo",lat=18.9078728, lng=-99.1797925, opacity = .9, fill = TRUE,  fillOpacity = .9) %>%
addCircleMarkers(data =del_map_jiu, radius = 10, group=~Tipo,  lat = as.numeric(del_map_jiu$Lat), lng = as.numeric(del_map_jiu$Long), opacity = .9, fill = TRUE,
label = ~htmlEscape(Tipo), fillOpacity = 0.8, color = "red",
stroke = FALSE, labelOptions = labelOptions(noHide=T, offset = c(-3,0), textOnly = T),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Zona: ",del_map_jiu$Tipo,  "</div><br>",
"Nota:", del_map_jiu$Nota, "<br>",
"Fecha:", paste0(del_map_jiu$Fecha, del_map_jiu$Mes)))
del_map_jiu<-read_xlsx("Jiutepec.xlsx", sheet = "Notas")
mapa_2<-leaflet(width ="830px", height="520px") %>% setView( -99.17547, 18.88528, 12.5 ) %>% addTiles() %>%
addPolygons(data = shp_jiu, weight = 5, fillOpacity = 0, color = '#F135FF') %>%
addPolygons(data = black_zone, weight = 5, fillColor = '#000', fillOpacity = 0.7, color = '#F135FF') %>%
addPolygons(data = shp, weight = 2, fillOpacity = 0, color = '#007bff',  label = ~SETT_NAME,
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Zona: ",shp$SETT_NAME,  "</div><br>",
"Tipo de vivienda: ", shp$SETT_TYPE,"<br>"))  %>%
addDrawToolbar(targetGroup='datos', position = "bottomleft",
editOptions = editToolbarOptions(selectedPathOptions = selectedPathOptions())) %>%
addCircleMarkers(color="#1788d3", radius = 10, label ="San Pablo",lat=18.9078728, lng=-99.1797925, opacity = .9, fill = TRUE,  fillOpacity = .9) %>%
addCircleMarkers(data =del_map_jiu, radius = 10, group=~Tipo,  lat = as.numeric(del_map_jiu$Lat), lng = as.numeric(del_map_jiu$Long), opacity = .9, fill = TRUE,
label = ~htmlEscape(Tipo), fillOpacity = 0.8, color = "red",
stroke = FALSE, labelOptions = labelOptions(noHide=T, offset = c(-3,0), textOnly = T),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Zona: ",del_map_jiu$Tipo,  "</div><br>",
"Nota:", del_map_jiu$Nota, "<br>",
"Fecha:", paste0(del_map_jiu$Fecha, del_map_jiu$Mes)))
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
limpia_del<-function(delitos){
delitos<-delitos %>%
pivot_longer(cols =c(Enero:Diciembre),
names_to = c("mes"),
values_to = "delitos") %>%
mutate(mes=case_when(mes=="Enero"~"01-01",
mes=="Febrero"~"02-01",
mes=="Marzo"~"03-01",
mes=="Abril"~"04-01",
mes=="Mayo"~"05-01",
mes=="Junio"~"06-01",
mes=="Julio"~"07-01",
mes=="Agosto"~"08-01",
mes=="Septiembre"~"09-01",
mes=="Octubre"~"10-01",
mes=="Noviembre"~"11-01",
mes=="Diciembre"~"12-01")) %>%
mutate(mes=as.Date(paste(años, mes, sep="-")))
return(delitos)}
des_anos<-function(delitos){
delitos<-delitos%>% group_by(Modalidad, años) %>% summarise(n=mean(delitos, na.rm=T)) %>% arrange(desc(n)) %>%
reshape2::dcast(Modalidad~años, value.var = "n", sum) %>% rowwise() %>%
mutate(comp=comparativo(`2024`, `2023`)) %>% mutate(comp1=comparativo(`2023`, `2022`)) %>%
mutate(`2024`=accounting(`2024`, digits = 1L)) %>%
mutate(`2023`=accounting(`2023`, digits = 1L)) %>%
mutate(`2022`=accounting(`2022`, digits = 1L))%>%
arrange(desc(`2024`))
delitos=1:nrow(delitos) %>% data.frame()%>% bind_cols(delitos)
names(delitos)[1]<-"Rank"
delitos1<-delitos %>% head(14)
delitos<- bind_rows(delitos1,delitos[delitos$Modalidad=="Extorsi\xf3n",] ) %>%
mutate(Modalidad= case_when(Modalidad=="Da\xf1o a la propiedad"~"Daño a la propiedad",
Modalidad=="Otros delitos del Fuero Com\xfan"~"Otros delitos del Fuero Común",
Modalidad=="Extorsi\xf3n"~"Extorsión",
.default = as.character(Modalidad))) %>%
mutate(Modalidad=case_when(Modalidad=="Amenazas"~ "<b>Amenazas</b>",
Modalidad=="Robo de motocicleta Sin violencia"~"<b>Robo de motocicleta Sin violencia</b>",
Modalidad=="Robo de coche de 4 ruedas Con violencia"~"<b>Robo de coche de 4 ruedas Sin violencia</b>" ,
Modalidad=="Robo de coche de 4 ruedas Sin violencia"~"<b>Robo de coche de 4 ruedas Sin violencia</b>" ,
Modalidad=="Robo de motocicleta Con violencia"~"<b>Robo de motocicleta Con violencia</b>" ,
Modalidad=="Extorsión"~"<b>Extorsión</b>", .default = as.character(Modalidad)))
names(delitos)[c(6:7)]<-c("Var año pasado", "Var periodo anterior")
return(delitos)}
comparativo<-function(val_act, val_ant){
if(val_act>0 & val_ant>0){
com<-round(100*((val_act-val_ant)/val_ant),2)
}else{com=NA}
return(com)}
arregla_tabla<-function(tabla){
tabla<-formattable(tabla,
align = c("l","l","r", "r", "r", "r", "r"),
list(`Municipio` = formatter("span", style = ~ style(color = "grey", font.weight = "bold", fontFamily = "Sans-serif")),
`2022` = color_bar("#d9ebba"),
`2023` = color_bar("#d9ebba"),
`2024` = color_bar("#d9ebba"),
`Var año pasado` = formatter("span",
style = ~ style(color = ifelse(`Var año pasado` <0, "green", "red")),
~ icontext(sapply(`Var año pasado`, function(x) if (x <= 0) "chevron-down" else if (x > 0) "chevron-up" else ""), `Var año pasado`)),
`Var periodo anterior` = formatter("span",
style = ~ style(color = ifelse(`Var periodo anterior` <0, "green", "red")),
~ icontext(sapply(`Var periodo anterior`, function(x) if (x <= 0) "chevron-down" else if (x > 0) "chevron-up" else ""), `Var periodo anterior`))),
table.attr = 'style="font-size: 18px; line-height = 2em; ";\"')
return(tabla)}
suma_del<-function(delitos){
delitos<-delitos %>%
filter(años == "2024") %>%
summarise(total_delitos = sum(delitos, na.rm = TRUE)) %>%
pull(total_delitos) %>% format(big.mark=",")
return(delitos)}
prom_mes_jiu<-delitos_jiu %>% filter(años>=2022) %>% des_anos()
tabla2<- arregla_tabla(prom_mes_jiu)
prom_mes_cue<-delitos_cue  %>% filter(años>=2022)%>% des_anos()
tabla3<- arregla_tabla(prom_mes_cue)
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
mapa_2<-leaflet(width ="830px", height="520px") %>% setView( -99.17547, 18.88528, 12.5 ) %>% addTiles() %>%
addPolygons(data = shp_jiu, weight = 5, fillOpacity = 0, color = '#F135FF') %>%
addPolygons(data = black_zone, weight = 5, fillColor = '#000', fillOpacity = 0.7, color = '#F135FF') %>%
addPolygons(data = shp, weight = 2, fillOpacity = 0, color = '#007bff',  label = ~SETT_NAME,
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Zona: ",shp$SETT_NAME,  "</div><br>",
"<b>Tipo de vivienda</b>: ", shp$SETT_TYPE,"<br>"))  %>%
addDrawToolbar(targetGroup='datos', position = "bottomleft",
editOptions = editToolbarOptions(selectedPathOptions = selectedPathOptions())) %>%
addCircleMarkers(color="#1788d3", radius = 10, label ="San Pablo",lat=18.9078728, lng=-99.1797925, opacity = .9, fill = TRUE,  fillOpacity = .9) %>%
addCircleMarkers(data =del_map_jiu, radius = 10, group=~Tipo,  lat = as.numeric(del_map_jiu$Lat), lng = as.numeric(del_map_jiu$Long), opacity = .9, fill = TRUE,
label = ~htmlEscape(Tipo), fillOpacity = 0.8, color = "red",
stroke = FALSE, labelOptions = labelOptions(noHide=T, offset = c(-3,0), textOnly = T),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Zona: ",del_map_jiu$Tipo,  "</div><br>",
"<b>Nota</b>:", del_map_jiu$Nota, "<br>",
"<b>Fecha</b>:", paste(del_map_jiu$Mes,del_map_jiu$Fecha)))
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
des_anos<-function(delitos){
delitos<-delitos%>% group_by(Modalidad, años) %>% summarise(n=mean(delitos, na.rm=T)) %>% arrange(desc(n)) %>%
reshape2::dcast(Modalidad~años, value.var = "n", sum) %>% rowwise() %>%
mutate(comp=comparativo(`2024`, `2023`)) %>% mutate(comp1=comparativo(`2023`, `2022`)) %>%
mutate(`2024`=accounting(`2024`, digits = 1L)) %>%
mutate(`2023`=accounting(`2023`, digits = 1L)) %>%
mutate(`2022`=accounting(`2022`, digits = 1L))%>%
arrange(desc(`2024`))
delitos=1:nrow(delitos) %>% data.frame()%>% bind_cols(delitos)
names(delitos)[1]<-"Rank"
delitos1<-delitos %>% head(13)
delitos<- bind_rows(delitos1,delitos[delitos$Modalidad=="Extorsi\xf3n",] ) %>%
mutate(Modalidad= case_when(Modalidad=="Da\xf1o a la propiedad"~"Daño a la propiedad",
Modalidad=="Otros delitos del Fuero Com\xfan"~"Otros delitos del Fuero Común",
Modalidad=="Extorsi\xf3n"~"Extorsión",
.default = as.character(Modalidad))) %>%
mutate(Modalidad=case_when(Modalidad=="Amenazas"~ "<b>Amenazas</b>",
Modalidad=="Robo de motocicleta Sin violencia"~"<b>Robo de motocicleta Sin violencia</b>",
Modalidad=="Robo de coche de 4 ruedas Con violencia"~"<b>Robo de coche de 4 ruedas Sin violencia</b>" ,
Modalidad=="Robo de coche de 4 ruedas Sin violencia"~"<b>Robo de coche de 4 ruedas Sin violencia</b>" ,
Modalidad=="Robo de motocicleta Con violencia"~"<b>Robo de motocicleta Con violencia</b>" ,
Modalidad=="Extorsión"~"<b>Extorsión</b>", .default = as.character(Modalidad)))
names(delitos)[c(6:7)]<-c("Var año pasado", "Var periodo anterior")
return(delitos)}
prom_mes_jiu<-delitos_jiu %>% filter(años>=2022) %>% des_anos()
tabla2<- arregla_tabla(prom_mes_jiu)
prom_mes_cue<-delitos_cue  %>% filter(años>=2022)%>% des_anos()
tabla3<- arregla_tabla(prom_mes_cue)
tabla3
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
black_zone$SETT_NAME
str_to_title(black_zone$SETT_NAME)
black_zone %>%  str_to_title(SETT_NAME) %>% toString(SETT_NAME)
black_zone %>% mutate(SETT_NAME=str_to_title(SETT_NAME))
black_zone %>% mutate(SETT_NAME=str_to_title(SETT_NAME)) %>% toString(SETT_NAME)
black_zone %>% mutate(SETT_NAME=str_to_title(SETT_NAME)) %>% pull(SETT_NAME) %>% toString(SETT_NAME)
black_zone %>% mutate(SETT_NAME=str_to_title(SETT_NAME)) %>% pull(SETT_NAME) %>% toString()
black_zone %>% mutate(SETT_NAME=str_to_title(SETT_NAME)) %>% pull(SETT_NAME) %>% toString()
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
rmarkdown::render("press.Rmd", output_file = "press.html",
params = list(graph1=graph1, titulo_1=titulo_1, tabla1=tabla1, mapa1=mapa1,
tabla2=tabla2, tabla3=tabla3, mapa_2=mapa_2))
source("graphs.R")
shp <- st_read("/shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
library(dplyr)
library(data.table)
library(tidyr)
library(stringr)
library(sf)
library(jsonlite)
library(highcharter)
library(formattable)
library(readxl)
shp <- st_read("/shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
st_read("shp-Colonias/Colonias.shp")
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
shp<-shp %>% filter(ST_NAME=="MORELOS" & MUN_NAME== "JIUTEPEC") %>%
st_as_sf( ) %>% st_zm( drop = T, what = "ZM")
black_zone<-bind_rows(
shp %>% filter(SETT_NAME=="MORELOS"),
shp %>% filter(SETT_NAME=="EL PORVENIR"),
shp %>%  mutate(esta=case_when(grepl("OTILIO MONTAÑO", SETT_NAME)==T~1)) %>%  filter(esta==1),
shp %>%  mutate(esta=case_when(grepl("CIVAC", SETT_NAME)==T~1)) %>%  filter(esta==1),
shp %>% mutate(esta=case_when(grepl("TEJALPA", SETT_NAME)==T~1)) %>%  filter(esta==1))
shp1<-read_json("morelos.json")
del_map_jiu<-read_xlsx("Jiutepec.xlsx", sheet = "Notas")
delitos<-fread("/Users/javier/Downloads/Municipal-Delitos-2015-2024_jun2024/Municipal-Delitos-2015-2024_jun2024.csv")
names(delitos)[c(1,6)]<-c("años", "Bien juridico afectado")
delitos<-delitos %>% filter(Entidad=="Morelos" )
shp_jiu <- st_read("/shp-Municipios/Municipios.shp")%>% st_transform( "+init=epsg:4326") %>%
filter(Estado=="Morelos" & Municipios=="Jiutepec")%>% st_as_sf( )
shp_jiu <- st_read("shp-Municipios/Municipios.shp")%>% st_transform( "+init=epsg:4326") %>%
filter(Estado=="Morelos" & Municipios=="Jiutepec")%>% st_as_sf( )
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
library(dplyr)
library(data.table)
library(tidyr)
library(stringr)
library(sf)
library(jsonlite)
library(highcharter)
library(formattable)
library(readxl)
source("funciones.R")
source("graphs.R")
# shp <- st_read("/Users/javier/Desktop/carpeta sin título/shp-bds_edos/shp-Municipios/Municipios.shp")
# shp<-shp %>% filter(Estado=="Morelos")
# shp1 <-shp %>% st_as_sf( )
# write_json(shp1, "morelos.json")
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
shp<-shp %>% filter(ST_NAME=="MORELOS" & MUN_NAME== "JIUTEPEC") %>%
st_as_sf( ) %>% st_zm( drop = T, what = "ZM")
black_zone<-bind_rows(
shp %>% filter(SETT_NAME=="MORELOS"),
shp %>% filter(SETT_NAME=="EL PORVENIR"),
shp %>%  mutate(esta=case_when(grepl("OTILIO MONTAÑO", SETT_NAME)==T~1)) %>%  filter(esta==1),
shp %>%  mutate(esta=case_when(grepl("CIVAC", SETT_NAME)==T~1)) %>%  filter(esta==1),
shp %>% mutate(esta=case_when(grepl("TEJALPA", SETT_NAME)==T~1)) %>%  filter(esta==1))
shp_jiu <- st_read("shp-Municipios/Municipios.shp")%>% st_transform( "+init=epsg:4326") %>%
filter(Estado=="Morelos" & Municipios=="Jiutepec")%>% st_as_sf( )
shp1<-read_json("morelos.json")
del_map_jiu<-read_xlsx("Jiutepec.xlsx", sheet = "Notas")
#PON LA DIRECCIÓN DEL ARCHIVO QUE DESCARGASTE
delitos<-fread("/Users/javier/Downloads/Municipal-Delitos-2015-2024_jun2024/Municipal-Delitos-2015-2024_jun2024.csv")
names(delitos)[c(1,6)]<-c("años", "Bien juridico afectado")
delitos<-delitos %>% filter(Entidad=="Morelos" )
delitos0<-delitos %>% select(años, Modalidad, c(10:21)) %>%  limpia_del()
delitos_jiu<-delitos %>% filter( `Cve. Municipio`=="17011") %>% select(años, Modalidad, c(10:21)) %>%  limpia_del()
delitos_cue<-delitos %>% filter( `Cve. Municipio`=="17007") %>% select(años, Modalidad, c(10:21)) %>%  limpia_del()
graph1<-delitos0 %>% group_by(mes) %>% summarise(Total=sum(delitos)) %>%
left_join(delitos_jiu %>% group_by(mes) %>% summarise(Jiutepec=sum(delitos)) ) %>%
left_join(delitos_cue %>% group_by(mes) %>% summarise(Cuernavaca=sum(delitos)) ) %>% drop_na() %>%
pivot_longer(cols =c(Total:Cuernavaca), names_to = c("mes1"), values_to = "delitos") %>%
g_line( "Incidentes", "Fecha")
titulo_1 <-paste("Delitos 2024: Total=", delitos0 %>%suma_del(),
", Cuernavaca:", delitos_cue %>%suma_del(),
", Jiutepec:", delitos_jiu %>%suma_del())
tabla1<-delitos %>% filter( años==2024) %>%
select(Municipio, años, Modalidad, c(10:21)) %>%
limpia_del() %>% group_by(Municipio) %>%
summarise(n=sum(delitos, na.rm=T)) %>% arrange(desc(n)) %>%
mutate(por= (n)/sum(n, na.rm = T)) %>% mutate(n=accounting(n, digits = 0L)) %>%
head(14)%>% mutate(Municipio=case_when(Municipio=="Tepoztl\xe1n"~"Tepoztlán",
Municipio=="Tlaltizap\xe1n de Zapata"~"Tlaltizapán de Zapata",
.default = as.character(Municipio)))
colnames(tabla1) <- c("Municipio", "Delitos", "Porcentaje")
tabla1<- formattable(tabla1,
align = c("l","r", "r"),
list(`Municipio` = formatter("span", style = ~ style(color = "grey", font.weight = "bold", fontFamily = "Sans-serif")),
`Delitos` = color_bar("#d9ebba"),
`Porcentaje` = percent), table.attr = 'style="font-size: 20px; line-height = 2em; ";\"')
mapa1<-delitos %>% filter( años==2024) %>%
select(`Cve. Municipio`, años, Modalidad, c(10:21)) %>%
limpia_del() %>% group_by(`Cve. Municipio`) %>% summarise(n=sum(delitos, na.rm=T)) %>%
mutate(`Cve. Municipio`=as.character(`Cve. Municipio`)) %>%
rename(CVEGEO="Cve. Municipio") %>% mapas(shp1)
prom_mes_jiu<-delitos_jiu %>% filter(años>=2022) %>% des_anos()
tabla2<- arregla_tabla(prom_mes_jiu)
prom_mes_cue<-delitos_cue  %>% filter(años>=2022)%>% des_anos()
tabla3<- arregla_tabla(prom_mes_cue)
library(leaflet)
library(leaflet.extras)
mapa_2<-leaflet(width ="830px", height="520px") %>% setView( -99.17547, 18.88528, 12.5 ) %>% addTiles() %>%
addPolygons(data = shp_jiu, weight = 5, fillOpacity = 0, color = '#F135FF') %>%
addPolygons(data = black_zone, weight = 5, fillColor = '#000', fillOpacity = 0.7, color = '#F135FF') %>%
addPolygons(data = shp, weight = 2, fillOpacity = 0, color = '#007bff',  label = ~SETT_NAME,
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Zona: ",shp$SETT_NAME,  "</div><br>",
"<b>Tipo de vivienda</b>: ", shp$SETT_TYPE,"<br>"))  %>%
addDrawToolbar(targetGroup='datos', position = "bottomleft",
editOptions = editToolbarOptions(selectedPathOptions = selectedPathOptions())) %>%
addCircleMarkers(color="#1788d3", radius = 10, label ="San Pablo",lat=18.9078728, lng=-99.1797925, opacity = .9, fill = TRUE,  fillOpacity = .9) %>%
addCircleMarkers(data =del_map_jiu, radius = 10, group=~Tipo,  lat = as.numeric(del_map_jiu$Lat), lng = as.numeric(del_map_jiu$Long), opacity = .9, fill = TRUE,
label = ~htmlEscape(Tipo), fillOpacity = 0.8, color = "red",
stroke = FALSE, labelOptions = labelOptions(noHide=T, offset = c(-3,0), textOnly = T),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Zona: ",del_map_jiu$Tipo,  "</div><br>",
"<b>Nota</b>:", del_map_jiu$Nota, "<br>",
"<b>Fecha</b>:", paste(del_map_jiu$Mes,del_map_jiu$Fecha)))
mapa1
delitos %>% filter( años==2024) %>%
select(`Cve. Municipio`, años, Modalidad, c(10:21)) %>%
limpia_del() %>% group_by(`Cve. Municipio`) %>% summarise(n=sum(delitos, na.rm=T)) %>%
mutate(`Cve. Municipio`=as.character(`Cve. Municipio`)) %>%
rename(CVEGEO="Cve. Municipio")
shp1
mapa1
mapa1<-delitos %>% filter( años==2024) %>%
select(`Cve. Municipio`, años, Modalidad, c(10:21)) %>%
limpia_del() %>% group_by(`Cve. Municipio`) %>% summarise(n=sum(delitos, na.rm=T)) %>%
mutate(`Cve. Municipio`=as.character(`Cve. Municipio`)) %>%
rename(CVEGEO="Cve. Municipio")
mapa1
shp1
View(mapa1)
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
library(dplyr)
library(data.table)
library(tidyr)
library(stringr)
library(sf)
library(jsonlite)
library(highcharter)
library(formattable)
library(readxl)
source("funciones.R")
source("graphs.R")
delitos<-fread("/Users/javier/Downloads/Municipal-Delitos-2015-2024_jun2024/Municipal-Delitos-2015-2024_jun2024.csv")
names(delitos)[c(1,6)]<-c("años", "Bien juridico afectado")
delitos<-delitos %>% filter(Entidad=="Morelos" )
prom_mes_jiu<-delitos_jiu %>% filter(años>=2022) %>% des_anos()
delitos0<-delitos %>% select(años, Modalidad, c(10:21)) %>%  limpia_del()
delitos_jiu<-delitos %>% filter( `Cve. Municipio`=="17011") %>% select(años, Modalidad, c(10:21)) %>%  limpia_del()
delitos_cue<-delitos %>% filter( `Cve. Municipio`=="17007") %>% select(años, Modalidad, c(10:21)) %>%  limpia_del()
prom_mes_jiu<-delitos_jiu %>% filter(años>=2022) %>% des_anos()
prom_mes_jiu
delitos_jiu
tabla3
tabla2
prom_mes_jiu<-delitos_jiu %>% filter(años>=2022) %>% des_anos()
tabla2<- arregla_tabla(prom_mes_jiu)
tabla2
#colores<-colores[1:length(unique(tabla$grupo))]
tabla<-tabla %>% hchart(type="line", hcaes(x=fecha, y=n, group=grupo), color=colores[1:length(unique(tabla$grupo))]) %>%
hc_yAxis(gridLineWidth = 0, title = list(enabled = T, text = ytext,
style = list(color = "#5C666F", useHTML = TRUE, fontWeight = "bold", fontFamily = "Titillium Web", fontSize = "1.2em")),
stackLabels = list(color = "#5C666F", y=10, fontWeight = "bold", enabled = TRUE),
labels = list(enabled = TRUE, rotation=0, style = list( fontFamily = "Titillium Web", color =  "#5C666F", fontSize = "1.1em"))) %>%
hc_exporting(enabled = T) %>%
hc_xAxis(title= list(text=xtext, style = list(color = "#5C666F", useHTML = TRUE, fontWeight = "bold", fontFamily = "Titillium Web", fontSize = "1.2em")),
labels = list(rotation=0, style = list( fontFamily = "Titillium Web", color =  "#5C666F",  fontSize = "1.1em"))) %>%
hc_chart(zoomType = "x") %>%
# hc_title(text= titulo, margin = 7, align = "center",
#          style = list(color = "#5C666F", useHTML = TRUE,  fontFamily = "Titillium Web"))%>%
hc_legend(enabled=T, borderWidth = 1, borderColor = "#EEF2F5", align = "center", itemHoverStyle = list(color = "#1E242B", fontSize = "1.1em"),
itemStyle = list(fontFamily = "Titillium Web", color = "#5C666F", fontWeight="normal")) %>%
hc_tooltip(crosshairs = F, shared = T, useHTML = TRUE, borderWidth = 1, backgroundColor = "#1E242B", fillOpacity = 0.85, borderRadius=15,
sort = TRUE, style = list(align = "center",fontWeight="400", color = "#EEF2F5", fontFamily = "Titillium Web"),
headerFormat = paste("Mes", ": <b>{point.key}</b><hr hr style='margin: 4px 0px 0px 5px;'>"),
footerFormat='<table>', valueDecimals= 0, useHTML = TRUE)
library(sf)
library(jsonlite)
library(highcharter)
library(formattable)
library(readxl)
source("funciones.R")
source("graphs.R")
shp <- st_read("shp-Colonias/Colonias.shp")
View(shp)
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
View(shp)
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
shp<-shp %>% filter(ST_NAME=="MORELOS" & MUN_NAME== "JIUTEPEC") %>%
st_as_sf( ) %>% st_zm( drop = T, what = "ZM")
View(shp)
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
shp<-shp %>% filter(ST_NAME=="MORELOS" & MUN_NAME== "JIUTEPEC") %>%
st_as_sf( ) %>% st_zm( drop = T, what = "ZM")
shp <- st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
shp %>% filter(ST_NAME=="MORELOS" & MUN_NAME== "JIUTEPEC")
shp
shp %>% st_as_sf( ) %>% st_zm( drop = T, what = "ZM")
shp %>% st_as_sf( )
library(httr)
library(jsonlite)
res <- VERB("GET", url = "https://web1ws.widetech.co/wsHistoryGetByPlate.asmx/HistoyDataLastLocationByUser_JSON?sLogin=WS_History_SANPABLO&sPassword=462D53414E5041424C4F2E475053")
tablas<-fromJSON(content(res, as='text'))
as2<-tablas[[1]][["Response"]][["Plate"]][["hst"]] %>%
mutate(Latitude=as.numeric(Latitude), Longitude=as.numeric(Longitude))
tablas<-fromJSON(content(res, as='text'))
as2<-tablas[[1]][["Response"]][["Plate"]][["hst"]] %>%
mutate(Latitude=as.numeric(Latitude), Longitude=as.numeric(Longitude))
library(dplyr)
tablas<-fromJSON(content(res, as='text'))
as2<-tablas[[1]][["Response"]][["Plate"]][["hst"]] %>%
mutate(Latitude=as.numeric(Latitude), Longitude=as.numeric(Longitude))
library(leaflet)
library(htmltools)
crea_icon_number<-function(number, colors){
icons <- awesomeIcons(
icon = 'ion-numeric',
markerColor = colors,
iconColor = 'white',
text = number)
return(icons)}
View(as2)
leaflet() %>% addTiles() %>%
# addAwesomeMarkers(data =as , icon = crea_icon_number(as$`@id`, "blue"),
#                   lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
#                   popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as$`@id`,  "</div>")) %>%
# addAwesomeMarkers(data =as1, icon = crea_icon_number(as1$`@id`, "red"),
#                   lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
#                   popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as1$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as2, icon = crea_icon_number(as2$`@id`, "orange"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as2$`@id`,  "</div>"))
leaflet() %>% addTiles() %>%
# addAwesomeMarkers(data =as , icon = crea_icon_number(as$`@id`, "blue"),
#                   lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
#                   popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as1, icon = crea_icon_number(as1$`@id`, "red"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as1$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as2, icon = crea_icon_number(as2$`@id`, "orange"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as2$`@id`,  "</div>"))
as1<-tablas[[1]][["Response"]][["Plate"]][["hst"]] %>%
mutate(Latitude=as.numeric(Latitude), Longitude=as.numeric(Longitude))
leaflet() %>% addTiles() %>%
# addAwesomeMarkers(data =as , icon = crea_icon_number(as$`@id`, "blue"),
#                   lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
#                   popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as1, icon = crea_icon_number(as1$`@id`, "red"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as1$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as2, icon = crea_icon_number(as2$`@id`, "orange"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as2$`@id`,  "</div>"))
res <- VERB("GET", url = "https://web1ws.widetech.co/wsHistoryGetByPlate.asmx/HistoyDataLastLocationByUser_JSON?sLogin=WS_History_SANPABLO&sPassword=462D53414E5041424C4F2E475053")
tablas<-fromJSON(content(res, as='text'))
as1<-tablas[[1]][["Response"]][["Plate"]][["hst"]] %>%
mutate(Latitude=as.numeric(Latitude), Longitude=as.numeric(Longitude))
leaflet() %>% addTiles() %>%
# addAwesomeMarkers(data =as , icon = crea_icon_number(as$`@id`, "blue"),
#                   lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
#                   popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as1, icon = crea_icon_number(as1$`@id`, "red"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as1$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as2, icon = crea_icon_number(as2$`@id`, "orange"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as2$`@id`,  "</div>"))
tablas<-fromJSON(content(res, as='text'))
as<-tablas[[1]][["Response"]][["Plate"]][["hst"]] %>%
mutate(Latitude=as.numeric(Latitude), Longitude=as.numeric(Longitude))
leaflet() %>% addTiles() %>%
addAwesomeMarkers(data =as , icon = crea_icon_number(as$`@id`, "blue"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as1, icon = crea_icon_number(as1$`@id`, "red"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as1$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as2, icon = crea_icon_number(as2$`@id`, "orange"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as2$`@id`,  "</div>"))
as<-tablas[[1]][["Response"]][["Plate"]][["hst"]] %>%
mutate(Latitude=as.numeric(Latitude), Longitude=as.numeric(Longitude))
leaflet() %>% addTiles() %>%
addAwesomeMarkers(data =as , icon = crea_icon_number(as$`@id`, "blue"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as1, icon = crea_icon_number(as1$`@id`, "red"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as1$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as2, icon = crea_icon_number(as2$`@id`, "orange"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as2$`@id`,  "</div>"))
as
res <- VERB("GET", url = "https://web1ws.widetech.co/wsHistoryGetByPlate.asmx/HistoyDataLastLocationByUser_JSON?sLogin=WS_History_SANPABLO&sPassword=462D53414E5041424C4F2E475053")
tablas<-fromJSON(content(res, as='text'))
as<-tablas[[1]][["Response"]][["Plate"]][["hst"]] %>%
mutate(Latitude=as.numeric(Latitude), Longitude=as.numeric(Longitude))
leaflet() %>% addTiles() %>%
addAwesomeMarkers(data =as , icon = crea_icon_number(as$`@id`, "blue"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as1, icon = crea_icon_number(as1$`@id`, "red"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as1$`@id`,  "</div>")) %>%
addAwesomeMarkers(data =as2, icon = crea_icon_number(as2$`@id`, "orange"),
lat = ~Latitude, lng = ~Longitude,  label = ~htmlEscape(PDI),
popup = paste0("<div style='font-size: 17px; font-weight:bold; text-align: center; background: white; padding: 4px; border-radius: 4px;'>","Unidad ",as2$`@id`,  "</div>"))
st_read("shp-Colonias/Colonias.shp") %>% st_transform( "+init=epsg:4326")
library(dplyr)
library(data.table)
library(tidyr)
library(stringr)
library(sf)
library(jsonlite)
library(highcharter)
library(formattable)
library(readxl)
shp1<-read_json("morelos.json")
library(dplyr)
library(data.table)
library(tidyr)
library(stringr)
library(sf)
library(jsonlite)
library(highcharter)
library(formattable)
library(readxl)
shp1<-read_json("morelos.json")
View(shp1)
