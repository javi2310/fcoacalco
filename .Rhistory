conditionalFormatting(wb, "Semáforo", cols=c(2,12), rows=3:(nrow(df)+2), rule='="Negro"', type = "expression", style = bs_Negro)
addStyle(wb, sheet = "Semáforo", bs_formato, rows =3:(nrow(df)+2), cols = 2:(ncol(df)+1), gridExpand = TRUE)
saveWorkbook(wb, file="semaforo.xlsx", overwrite = TRUE)
load("lista_unida_cdmx.RData")
lista_unida<-lista_unida %>% mutate(unidad=paste0("F", unidad))
names(lista_unida)<-c("Farmacia", "Hora", "Delitos AI (%)", "N Farderos (%)",
"Monto Farderos (%)", "Carpetas FGJ (%)", "Clientes (%)", "Incidente",  "Probabilidad")
Negro <- createStyle(fgFill = "#30302f", halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "white",bgFill = "#30302f",
borderColour = "#30302f", borderStyle = "thin")
bs_Negro <- createStyle(border = "TopBottom", borderColour = "#30302f")
Rojo <- createStyle(fgFill = "#9e1003",  halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "white", bgFill = "#9e1003",
borderColour = "#9e1003", borderStyle = "thin")
bs_Rojo <- createStyle(border = "TopBottom", borderColour = "#9e1003")
Naranja <- createStyle(fgFill = "#c96602", halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "white", bgFill = "#c96602",
borderColour = "#c96602", borderStyle = "thin")
bs_Naranja <- createStyle(border = "TopBottom", borderColour = "#c96602")
Amarillo <- createStyle(fgFill = "#d6cf06", halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "black", bgFill = "#d6cf06",
borderColour = "#d6cf06", borderStyle = "thin")
bs_Amarillo <- createStyle(border = "TopBottom", borderColour = "#d6cf06")
Verde <- createStyle(fgFill = "#076e3c", halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "white", bgFill = "#076e3c",
borderColour = "#076e3c", borderStyle = "thin")
bs_Verde <- createStyle(border = "TopBottom", borderColour = "#076e3c")
wb <- loadWorkbook("semaforo.xlsx")
unidades <- unique(lista_unida$Farmacia)
addWorksheet(wb, "Horarios", gridLines = FALSE)
for ( una in 1:length(unidades)) {#una=1
print(paste0("escribiendo: ", una))
dm<-lista_unida %>%
filter(Farmacia==unidades[una])
dm1<-df %>%
filter(Farmacia==unidades[una])
writeData(wb, "Horarios", dm1, startRow = 2, startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium" )
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = 3, cols = 2:(ncol(dm1)+1), gridExpand = TRUE)
writeData(wb, "Horarios", dm, startRow = 5, startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium")
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = 6:(nrow(dm)+5), cols = 2:(ncol(dm)+1), gridExpand = TRUE)
saveWorkbook(wb, file="semaforo.xlsx", overwrite = TRUE)
if(una>1){#una=2
guarda<-read_excel("semaforo.xlsx", sheet = "Horarios")
dm<-lista_unida %>%
filter(Farmacia==unidades[una])
dm1<-df %>%
filter(Farmacia==unidades[una])
writeData(wb, "Horarios", dm1, startRow = 6 + nrow(guarda), startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium")
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = (7 + nrow(guarda)), cols = 2:12, gridExpand = TRUE)
writeData(wb, "Horarios", dm, startRow = 9+ nrow(guarda), startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium")
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = (10+ nrow(guarda)):(nrow(dm)+ nrow(guarda)+9), cols = 2:10, gridExpand = TRUE)
saveWorkbook(wb, file="semaforo.xlsx", overwrite = TRUE)
}
}
load("semaforo.RData")
df<-df %>% mutate(unidad=paste0("F", unidad))
formato <- createStyle(fgFill = "#276cdb",  halign = "CENTER",  fontSize = 16,
textDecoration = "Bold", border = "Bottom",
fontColour = "white", bgFill = "#276cdb",
borderColour = "#276cdb", borderStyle = "thin")
df[is.na(df)]="NA"
bs_formato <- createStyle(border = "TopBottom", fontSize = 14, borderColour = "#276cdb")
bs_Negro <- createStyle(bgFill = "#30302f", fontSize = 14, textDecoration = "Bold", fontColour = "white")
bs_Rojo <- createStyle( bgFill = "#9e1003", fontSize = 14, textDecoration = "Bold", fontColour = "white")
bs_Naranja <- createStyle(bgFill = "#c96602", fontSize = 14, textDecoration = "Bold", fontColour = "white")
bs_Amarillo <- createStyle( bgFill = "#d6cf06", fontSize = 14, textDecoration = "Bold", fontColour = "black")
bs_Verde <- createStyle( bgFill = "#076e3c", fontSize = 14, textDecoration = "Bold", fontColour = "white")
wb<-createWorkbook("semaforo.xlsx")
addWorksheet(wb, "Semáforo", gridLines = FALSE)
names(df)<-c("Farmacia", "Delitos AI", "N Farderos", "Monto Farderos", "Carpetas",
"Venta promedio", "Módelo", "Estado", "Tam",
"Riesgo Score", "Clasificación","Venta nocturna")
writeData(wb, "Semáforo", df, startRow = 2, startCol = 2, headerStyle = formato,
borders = "rows", borderStyle = "medium")
conditionalFormatting(wb, "Semáforo", cols=c(2,12), rows=3:(nrow(df)+2), rule='="Amarillo"', type = "expression", style = bs_Amarillo)
conditionalFormatting(wb, "Semáforo", cols=c(2,12), rows=3:(nrow(df)+2), rule='="Naranja"',type = "expression", style = bs_Naranja)
conditionalFormatting(wb, "Semáforo", cols=c(2,12), rows=3:(nrow(df)+2), rule='="Rojo"', type = "expression", style = bs_Rojo)
conditionalFormatting(wb, "Semáforo", cols=c(2,12), rows=3:(nrow(df)+2), rule='="Verde"', type = "expression", style = bs_Verde)
conditionalFormatting(wb, "Semáforo", cols=c(2,12), rows=3:(nrow(df)+2), rule='="Negro"', type = "expression", style = bs_Negro)
addStyle(wb, sheet = "Semáforo", bs_formato, rows =3:(nrow(df)+2), cols = 2:(ncol(df)+1), gridExpand = TRUE)
saveWorkbook(wb, file="semaforo.xlsx", overwrite = TRUE)
load("lista_unida_cdmx.RData")
lista_unida<-lista_unida %>% mutate(unidad=paste0("F", unidad))
names(lista_unida)<-c("Farmacia", "Hora", "Delitos AI (%)", "N Farderos (%)",
"Monto Farderos (%)", "Carpetas FGJ (%)", "Clientes (%)", "Incidente",  "Probabilidad")
Negro <- createStyle(fgFill = "#30302f", halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "white",bgFill = "#30302f",
borderColour = "#30302f", borderStyle = "thin")
bs_Negro <- createStyle(border = "TopBottom", borderColour = "#30302f")
Rojo <- createStyle(fgFill = "#9e1003",  halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "white", bgFill = "#9e1003",
borderColour = "#9e1003", borderStyle = "thin")
bs_Rojo <- createStyle(border = "TopBottom", borderColour = "#9e1003")
Naranja <- createStyle(fgFill = "#c96602", halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "white", bgFill = "#c96602",
borderColour = "#c96602", borderStyle = "thin")
bs_Naranja <- createStyle(border = "TopBottom", borderColour = "#c96602")
Amarillo <- createStyle(fgFill = "#d6cf06", halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "black", bgFill = "#d6cf06",
borderColour = "#d6cf06", borderStyle = "thin")
bs_Amarillo <- createStyle(border = "TopBottom", borderColour = "#d6cf06")
Verde <- createStyle(fgFill = "#076e3c", halign = "CENTER",
textDecoration = "Bold", border = "Bottom",
fontColour = "white", bgFill = "#076e3c",
borderColour = "#076e3c", borderStyle = "thin")
bs_Verde <- createStyle(border = "TopBottom", borderColour = "#076e3c")
wb <- loadWorkbook("semaforo.xlsx")
unidades <- unique(lista_unida$Farmacia)
addWorksheet(wb, "Horarios", gridLines = FALSE)
for ( una in 1:length(unidades)) {#una=1
print(paste0("escribiendo: ", una))
dm<-lista_unida %>%
filter(Farmacia==unidades[una])
dm1<-df %>%
filter(Farmacia==unidades[una])
writeData(wb, "Horarios", dm1, startRow = 2, startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium" )
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = 3, cols = 2:(ncol(dm1)+1), gridExpand = TRUE)
writeData(wb, "Horarios", dm, startRow = 5, startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium")
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = 6:(nrow(dm)+5), cols = 2:(ncol(dm)+1), gridExpand = TRUE)
saveWorkbook(wb, file="semaforo.xlsx", overwrite = TRUE)
if(una>1){#una=2
guarda<-read_excel("semaforo.xlsx", sheet = "Horarios")
dm<-lista_unida %>%
filter(Farmacia==unidades[una])
dm1<-df %>%
filter(Farmacia==unidades[una])
writeData(wb, "Horarios", dm1, startRow = 6 + nrow(guarda), startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium")
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = (7 + nrow(guarda)), cols = 2:12, gridExpand = TRUE)
writeData(wb, "Horarios", dm, startRow = 9+ nrow(guarda), startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium")
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = (10+ nrow(guarda)):(nrow(dm)+ nrow(guarda)+9), cols = 2:10, gridExpand = TRUE)
saveWorkbook(wb, file="semaforo.xlsx", overwrite = TRUE)
}
}
rm(unidades)
rm(una)
load("lista_unida_NO_CDMX.RData")
lista_unida<-lista_unida %>% mutate(unidad=paste0("F", unidad))
names(lista_unida)<-c("Farmacia", "Hora", "Delitos AI (%)", "N Farderos (%)",
"Monto Farderos (%)", "clientes (%)", "Incidente",  "Probabilidad")
unidades <- unique(lista_unida$Farmacia)
wb <- loadWorkbook("semaforo.xlsx")
for ( una in 1:length(unidades)) {#una=1
print(paste0("escribiendo: ", una))
guarda<-read_excel("semaforo.xlsx", sheet = "Horarios")
dm<-lista_unida %>%
filter(Farmacia==unidades[una])
dm1<-df %>%
filter(Farmacia==unidades[una])
writeData(wb, "Horarios", dm1, startRow = 6 + nrow(guarda), startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium")
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = (7 + nrow(guarda)), cols = 2:12, gridExpand = TRUE)
writeData(wb, "Horarios", dm, startRow = 9+ nrow(guarda), startCol = 2, headerStyle = get(dm1$Clasificación),
borders = "rows", borderStyle = "medium")
addStyle(wb, sheet = "Horarios", get(paste0("bs_", dm1$Clasificación)), rows = (10+ nrow(guarda)):(nrow(dm)+ nrow(guarda)+9), cols = 2:9, gridExpand = TRUE)
saveWorkbook(wb, file="semaforo.xlsx", overwrite = TRUE)
}
library(tidyverse)
library(tidytext)
library(stringr)
library(highcharter)
library(stringi)
afinn <- read.csv("lexico_afinn.en.es.csv", stringsAsFactors = F, fileEncoding = "latin1") %>%
tbl_df() %>% mutate(Palabra=stri_trans_general(Palabra,  "Latin-ASCII")) %>%
mutate(Puntuacion= case_when(grepl("caro", Palabra)==T~-1,
grepl("tipo", Palabra)==T~0, .default = as.numeric(Puntuacion)))
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_1")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra") #%>%
# mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
# group_by(pal) %>% summarise(Palabra= toString(Palabra))
ejemplo1<-ejemplo1 %>% left_join(datos)
tap_1<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
pie_1_0<-function(a, colors){
names(a)<-c("Palabra", "n")
grafica<-hctreemap2(data = a, group_vars = c("Palabra"),
size_var = c("n"), layoutAlgorithm = "squarified",
levelIsConstant = FALSE,
levels = list(
list(level = 1, dataLabels = list(enabled = TRUE)) )) %>%
hc_plotOptions(treemap = list(dataLabels = list(enabled = TRUE, align = "center",
style = list(align = "center",color = "#5C666F", fontFamily = "Titillium Web"))) )%>%
hc_colorAxis(minColor = RColorBrewer::brewer.pal(7, colors)[1],
maxColor = RColorBrewer::brewer.pal(7, colors)[7]) %>%
hc_chart(zoomType = "y") %>%
hc_yAxis(title = list(text = "", style = list(color = "#5C666F", fontFamily = "Titillium Web",fontSize = "1.6em", useHTML = TRUE)),
labels = list( style = list( fontFamily = "Titillium Web", color =  "#5C666F", fontSize = "1.2em"))) %>%
hc_tooltip(formatter = JS('function () {
var total = 0;
for (var i = 0; i < this.series.data.length; i++)
{
if (this.series.data[i].node.children.length == 0)
total+=this.series.data[i].node.val;
}
var value;
if (this.point.node.children.length == 0)
{
value = this.point.options.value;
}
else
{
value = this.point.node.childrenTotal;
}
var porcentaje = (value / total) *100;
return "Palabra: <b>"  + this.point.name +"</b><br> Comentarios: <b>" + Highcharts.numberFormat(this.point.value,0)+"</b> <br> Porcentaje: <b>"+Highcharts.numberFormat(porcentaje,1)+"%"
}'), crosshairs = F, shared = T, borderWidth = 3, useHTML = TRUE, backgroundColor = "#5C666F", fillOpacity = 1, borderRadius=15,
sort = TRUE, style = list(align = "center",color = "#EEF2F5", fontFamily = "Titillium Web"))  %>%
hc_exporting(enabled = TRUE)%>%
hc_plotOptions(series = list( dataLabels =  list(format = "<b>{point.name:,.0f}<br>{point.value:,.0f}</b>", distance= 8,
style = list(color = "#243746", useHTML = TRUE, fontSize = "1.2em", fontFamily = "Montserrat")))) %>%
hc_legend(enable=TRUE, itemStyle = list(fontFamily = "Titillium Web",color = "#243746"))
return(grafica)}
library(tidyverse)
library(tidytext)
library(stringr)
library(highcharter)
library(stringi)
afinn <- read.csv("lexico_afinn.en.es.csv", stringsAsFactors = F, fileEncoding = "latin1") %>%
tbl_df() %>% mutate(Palabra=stri_trans_general(Palabra,  "Latin-ASCII")) %>%
mutate(Puntuacion= case_when(grepl("caro", Palabra)==T~-1,
grepl("tipo", Palabra)==T~0, .default = as.numeric(Puntuacion)))
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_1")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra") #%>%
# mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
# group_by(pal) %>% summarise(Palabra= toString(Palabra))
ejemplo1<-ejemplo1 %>% left_join(datos)
tap_1<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
####------------------------------
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_2")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra")# %>%
#mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
#group_by(pal) %>% summarise(Palabra= toString(Palabra))
#ejemplo1<-ejemplo1 %>% left_join(datos)
tap_2<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
##------------------------------
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_3")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra") #%>%
# mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
# group_by(pal) %>% summarise(Palabra= toString(Palabra))
#ejemplo1<-ejemplo1 %>% left_join(datos)
tap_3<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
##------------------------------
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_4")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment),
coment=gsub("solo", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra") #%>%
#  mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
# group_by(pal) %>% summarise(Palabra= toString(Palabra))
#ejemplo1<-ejemplo1 %>% left_join(datos)
tap_4<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
##------------------------------
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_5")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment),
coment=gsub("solo", "", coment),
coment=gsub("mayor", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra")# %>%
#mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
#group_by(pal) %>% summarise(Palabra= toString(Palabra))
ejemplo1<-ejemplo1 %>% left_join(datos)
tap_5<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
rmarkdown::render("press_capa.Rmd",
output_file = "press_preguntas_capacitacion.html",
params = list())
library(tidyverse)
library(tidytext)
library(stringr)
library(highcharter)
library(stringi)
afinn <- read.csv("lexico_afinn.en.es.csv", stringsAsFactors = F, fileEncoding = "latin1") %>%
tbl_df() %>% mutate(Palabra=stri_trans_general(Palabra,  "Latin-ASCII")) %>%
mutate(Puntuacion= case_when(grepl("caro", Palabra)==T~-1,
grepl("tipo", Palabra)==T~0, .default = as.numeric(Puntuacion)))
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_1")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra") #%>%
# mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
# group_by(pal) %>% summarise(Palabra= toString(Palabra))
ejemplo1<-ejemplo1 %>% left_join(datos)
tap_1<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
####------------------------------
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_2")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra")# %>%
#mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
#group_by(pal) %>% summarise(Palabra= toString(Palabra))
#ejemplo1<-ejemplo1 %>% left_join(datos)
tap_2<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
##------------------------------
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_3")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra") #%>%
# mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
# group_by(pal) %>% summarise(Palabra= toString(Palabra))
#ejemplo1<-ejemplo1 %>% left_join(datos)
tap_3<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
##------------------------------
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_4")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment),
coment=gsub("solo", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra") #%>%
#  mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
# group_by(pal) %>% summarise(Palabra= toString(Palabra))
#ejemplo1<-ejemplo1 %>% left_join(datos)
tap_4<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
##------------------------------
ejemplo1<-read_xlsx("DATA DE EJERCICIOS EN CAPACITACIÓN.xlsx", sheet="DATA_5")
names(ejemplo1)=c("coment")
ejemplo1<-ejemplo1 %>%
drop_na() %>%
mutate(pal=1:nrow(.))
datos<- ejemplo1 %>%
mutate(
coment= str_to_lower(stri_trans_general(coment,  "Latin-ASCII"))) %>%
mutate(coment= gsub("'", "", coment),
coment=gsub("solo", "", coment),
coment=gsub("mayor", "", coment)) %>%
mutate(coment=gsub("no ","", coment)) %>%
mutate(coment=gsub("si ","", coment)) %>%
unnest_tokens(input = "coment", output = "Palabra") %>%
inner_join(afinn, ., by = "Palabra")# %>%
#mutate(Tipo = ifelse(Puntuacion > 0, "Positiva", "Negativa")) %>%
#group_by(pal) %>% summarise(Palabra= toString(Palabra))
ejemplo1<-ejemplo1 %>% left_join(datos)
tap_5<-datos %>%
count(Palabra) %>%
arrange(desc(n)) %>% head(15) %>% pie_1_0("Greens")
rmarkdown::render("press_capa.Rmd",
output_file = "press_preguntas_capacitacion.html",
params = list())
library(dplyr)
library(data.table)
library(tidyr)
library(stringr)
library(sf)
library(jsonlite)
library(highcharter)
library(formattable)
library(readxl)
source("funciones.R")
source("graphs.R")
shp <- st_read("/Users/javierruizrubio/Desktop/fsp/SHP-Colonias") %>% st_transform( "+init=epsg:4326")
shp<-shp %>% filter(ST_NAME=="MEXICO" & MUN_NAME== "COACALCO DE BERRIOZÁBAL") %>%
st_as_sf( ) %>% st_zm( drop = T, what = "ZM")
black_zone<-bind_rows(
shp %>% filter(SETT_NAME=="MORELOS"),
shp %>% filter(SETT_NAME=="EL PORVENIR"),
shp %>%  mutate(esta=case_when(grepl("OTILIO MONTAÑO", SETT_NAME)==T~1)) %>%  filter(esta==1),
shp %>%  mutate(esta=case_when(grepl("CIVAC", SETT_NAME)==T~1)) %>%  filter(esta==1),
shp %>% mutate(esta=case_when(grepl("TEJALPA", SETT_NAME)==T~1)) %>%  filter(esta==1))
shp_coacalco <- st_read("/Users/javierruizrubio/Desktop/fsp/SHP-Municipios")%>%
st_transform( "+init=epsg:4326") %>%
filter(Estado=="México" & Municipios=="Coacalco de Berriozábal") %>%
st_as_sf( )
library(highcharter)
library(dplyr)
library(readxl)
library(rlang)
library(gt)
library(lubridate)
library(stringr)
library(tidyr)
library(dplyr)
library(data.table)
library(tidyr)
library(stringr)
library(sf)
library(jsonlite)
library(highcharter)
library(formattable)
library(readxl)
source("funciones.R")
source("graphs.R")
source("graphs.R")
